================================================================
   ğŸ‰ å¼•æ“è·¯ç”±å™¨é‡æ„å®Œæˆ
================================================================

ã€æ ¸å¿ƒæ”¹è¿›ã€‘

  1. èŒè´£åˆ†ç¦»
     â€¢ _analyze_qwen() - Qwen-VL å®ç° (Line 115-158)
     â€¢ analyze_image() - å¼•æ“è·¯ç”±å™¨ (Line 163-197)

  2. æ¸…æ™°çš„è·¯ç”±é€»è¾‘
     
     if engine == "cloud_qwen":
         return _analyze_qwen(image_path, lang=lang)
     elif engine == "cloud_gpt4o":
         raise RuntimeError("engine cloud_gpt4o not implemented yet")
     elif engine == "cloud_gemini":
         raise RuntimeError("engine cloud_gemini not implemented yet")
     else:
         raise ValueError(f"Unknown engine: {engine}")

  3. æ˜“äºæ‰©å±•
     â€¢ æ·»åŠ æ–°å¼•æ“åªéœ€ 3 æ­¥ï¼š
       1) å®ç° _analyze_xxx() å‡½æ•°
       2) åœ¨è·¯ç”±å™¨ä¸­æ·»åŠ åˆ†æ”¯: return _analyze_xxx(...)
       3) æ›´æ–°å‰ç«¯æ£€æŸ¥: if engine not in [...]

ã€ä»£ç è´¨é‡ã€‘

  âœ… è¯­æ³•éªŒè¯é€šè¿‡
  âœ… ä¿æŒç¼“å­˜è£…é¥°å™¨ (@st.cache_data)
  âœ… ä¿æŒ NoAPIKeyError æ£€æŸ¥
  âœ… ç»Ÿä¸€é”™è¯¯å¤„ç† (RuntimeError, ValueError)
  âœ… æ¸…æ™°çš„å‡½æ•°ç­¾åå’Œæ–‡æ¡£

ã€æ–‡ä»¶å˜æ›´ã€‘

  â€¢ src/fabric_api_infer.py
    - æ–°å¢ _analyze_qwen() å‡½æ•° (Line 115-158)
    - é‡æ„ analyze_image() ä¸ºè·¯ç”±å™¨ (Line 163-197)
    - ä¿æŒæ‰€æœ‰ç°æœ‰åŠŸèƒ½ä¸å˜

  â€¢ ENGINE_ROUTER.md
    - æ›´æ–°åç«¯ä¿æŠ¤è¯´æ˜
    - æ›´æ–°å¼•æ“çŠ¶æ€è¡¨
    - æ›´æ–°ä»£ç ç¤ºä¾‹
    - æ·»åŠ å®Œæ•´çš„æ‰©å±•æŒ‡å—

ã€éªŒæ”¶æ¸…å•ã€‘

  [x] _analyze_qwen() å‡½æ•°æå–å®Œæˆ
  [x] analyze_image() è·¯ç”±å™¨å®ç°
  [x] è¯­æ³•éªŒè¯é€šè¿‡
  [x] é”™è¯¯ç±»å‹æ­£ç¡® (RuntimeError, ValueError)
  [x] ä¿æŒç¼“å­˜è£…é¥°å™¨
  [x] ä¿æŒ NoAPIKeyError
  [x] æ–‡æ¡£æ›´æ–°å®Œæˆ

ã€æ‰©å±•ç¤ºä¾‹ã€‘

æ·»åŠ  GPT-4o-mini æ”¯æŒï¼š

1) å®ç°å‡½æ•°ï¼š
   def _analyze_gpt4o(image_path: str, lang: str = "zh") -> Dict:
       # å®ç° GPT-4o-mini æ¨ç†é€»è¾‘
       ...

2) æ›´æ–°è·¯ç”±å™¨ï¼š
   elif engine == "cloud_gpt4o":
       return _analyze_gpt4o(image_path, lang=lang)

3) æ›´æ–°å‰ç«¯ï¼š
   if engine not in ["cloud_qwen", "cloud_gpt4o"]:
       st.warning("è¯¥å¼•æ“å°šæœªå®ç°")

================================================================
æ›´æ–°æ—¶é—´: 2025-10-24
ç‰ˆæœ¬: 6.5 (Engine Router Refactor)
çŠ¶æ€: âœ… å®Œæˆå¹¶éªŒè¯é€šè¿‡
================================================================

